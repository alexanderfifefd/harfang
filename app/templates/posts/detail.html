{% extends "base_page.html" %}

{% load i18n partials %}

{% partialdef article %}
    <article class="max-w-none prose">
        <header>
            <hgroup>
                <h1>
                    <a href="{% url 'posts:detail' post.id %}" class="no-anchor">{{ post.title }}</a>
                </h1>
                <p>
                    {% blocktranslate trimmed with age=post.submit_date|timesince %}
                        Posted {{ age }} ago
                    {% endblocktranslate %}
                    {% translate "by" %}
                    {% include "partials/profile_link.html" with user=post.user %}
                    {% if user == post.user or user.is_moderator %}
                        ðŸž„
                        <a href="{% url 'posts:update' post.id %}">
                            {% translate "edit" %}
                        </a>
                        ðŸž„
                        <a href="{% url 'posts:delete' post.id %}">
                            {% translate "delete" %}
                        </a>
                    {% endif %}
                </p>
            </hgroup>
        </header>
        <p>
            <a href="{{ post.url }}" target="_blank" rel="noreferrer">{% translate "Link" %}</a>
        </p>
        <p>
            {{ post.body|linebreaks }}
        </p>
    </article>
{% endpartialdef %}

{% block content %}
    {% partial article %}
    <section>
        <div class="mb-4 max-w-none prose">
            {% if form %}
                <div hx-target="#comment-tree"
                     hx-swap="afterbegin"
                     hx-vals='{"tree": "true","commentFormEvent": "rootFormPosted"}'>
                    {% include "comments/form.html#form" %}
                </div>
            {% else %}
                <p>
                    {% translate "Log in to join the discussion." %}
                </p>
            {% endif %}
            <h2>
                {% translate "Comments" %} ({{ post.comments.count }})
            </h2>
        </div>
        {% include "comments/tree.html" %}
    </section>
{% endblock content %}
